<!-- src/app/flight-search/flight-search.component.html -->

<h1>Flight Search</h1>

<ng-container *ngIf="flights$ | async as flights">
  <form #flightSearchForm="ngForm">
    <div class="form-group">
      <label>From:</label>
      <input [(ngModel)]="from" [ngModelOptions]="{ updateOn: 'change'}" name="from" class="form-control" required
        minlength="3" maxlength="15" pattern="[a-zA-ZäöüÄÖÜß ]*" [city]="['Graz', 'Hamburg']" planet="Earth">

      <ng-container *ngIf="flightSearchForm.controls.from?.errors as errors">
        <dl class="text-danger">
          <div *ngFor="let e of errors | keyvalue">
            <dt>{{ e.key }}</dt>
            <dd *ngFor="let v of e.value | keyvalue | slice:1">
              {{ v.value | json }}
            </dd>
          </div>
        </dl>
      </ng-container>
    </div>

    <div class="form-group">
      <label>To:</label>
      <input [(ngModel)]="to" name="to" class="form-control">
    </div>

    <div class="form-group">
      <input [(ngModel)]="delayFilter" id="delayFilter" type="checkbox" name="delayFilter">
      &nbsp;
      <label for="delayFilter">Delayed</label>
    </div>

    <div class="form-group">
      <button class="btn btn-default" [disabled]="!from || !to" (click)="search()">
        Search
      </button>

      <button *ngIf="flights.length > 0" class="btn btn-default" (click)="delay()">
        Delay 1st Flight
      </button>

      <div *ngIf="flights.length > 0">
        {{flights.length}} flights found!
      </div>
    </div>
  </form>


  <div class="row">
    <div *ngFor="let f of flights" class="col-xs-12 col-sm-6 col-md-4 col-lg-4 col-xl-3">
      <flight-card [(selected)]="basket[f.id]" [item]="f">
      </flight-card>
    </div>
  </div>

  <b>Basket</b>
  <pre>{{ basket | json }}</pre>
</ng-container>